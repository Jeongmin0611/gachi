<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bitcamp.gachi.admin.ClassDaoImp">
	<select id="getAllRecordCount" parameterType="com.bitcamp.gachi.admin.TestVO" resultType="int">
		select count(code) from class
		<choose>
			<when test="option==null and dateOption==null and option==null"></when>
			<when test='option!=null and option.equals("전체")'>
				where code like '%${searchWord}%' or category like '%${searchWord}%' or 
				class_name like '%${searchWord}%' or userid like '%${searchWord}%' or class_state like '%${searchWord}%'
			</when>
			<when test='option!=null and !option.equals("전체")'>
				where ${option} like '%${searchWord}%'
			</when>
			<when test='!dateOption.equals("전체") and !category.equals("전체") and !class_state.equals("전체")'>
				where ${dateOption} between '${date1}' and '${date2}' and category='${category}' and class_state='${class_state}'
			</when>
			<when test='!dateOption.equals("전체") and !category.equals("전체") and class_state.equals("전체")'>
				where ${dateOption} between '${date1}' and '${date2}' and category='${category}'
			</when>
			<when test='!dateOption.equals("전체") and category.equals("전체") and class_state.equals("전체")'>
				where ${dateOption} between '${date1}' and '${date2}'
			</when>
			<when test='dateOption.equals("전체") and !category.equals("전체") and !class_state.equals("전체")'>
				where category='${category}' and class_state='${class_state}'
			</when>
			<when test='!dateOption.equals("전체") and category.equals("전체") and !class_state.equals("전체")'>
				where ${dateOption} between '${date1}' and '${date2}' and class_state='${class_state}'
			</when>
			<when test='dateOption.equals("전체") and category.equals("전체") and !class_state.equals("전체")'>
				where class_state='${class_state}'
			</when>
			<when test='dateOption.equals("전체") and !category.equals("전체") and class_state.equals("전체")'>
				where category='${category}'
			</when>
			<when test='!dateOption.equals("전체") and category.equals("전체") and class_state.equals("전체")'>
				where ${dateOption} between '${date1}' and '${date2}'
			</when>
			<otherwise></otherwise>
		</choose>
	</select>
	<select id="getClassListLookUp" parameterType="com.bitcamp.gachi.admin.TestVO" resultType="com.bitcamp.gachi.admin.ClassVO">
		select * from (select * from (select code,category,class_name,nickname,total_student,to_char(signup,'YYYY-MM-DD') signup,
		to_char(allow,'YYYY-MM-DD') allow,class_state from class c join member m on c.userid=m.userid 
		<choose>
			<when test="option==null and dateOption==null and category==null"></when>
			<when test='!dateOption.equals("전체") and !category.equals("전체") and !class_state.equals("전체")'>
				where ${dateOption} between '${date1}' and '${date2}' and category='${category}' and class_state='${class_state}'
			</when>
			<when test='!dateOption.equals("전체") and !category.equals("전체") and class_state.equals("전체")'>
				where ${dateOption} between '${date1}' and '${date2}' and category='${category}'
			</when>
			<when test='!dateOption.equals("전체") and category.equals("전체") and class_state.equals("전체")'>
				where ${dateOption} between '${date1}' and '${date2}'
			</when>
			<when test='dateOption.equals("전체") and !category.equals("전체") and !class_state.equals("전체")'>
				where category='${category}' and class_state='${class_state}'
			</when>
			<when test='!dateOption.equals("전체") and category.equals("전체") and !class_state.equals("전체")'>
				where ${dateOption} between '${date1}' and '${date2}' and class_state='${class_state}'
			</when>
			<when test='dateOption.equals("전체") and category.equals("전체") and !class_state.equals("전체")'>
				where class_state='${class_state}'
			</when>
			<when test='dateOption.equals("전체") and !category.equals("전체") and class_state.equals("전체")'>
				where category='${category}'
			</when>
			<when test='!dateOption.equals("전체") and category.equals("전체") and class_state.equals("전체")'>
				where ${dateOption} between '${date1}' and '${date2}'
			</when>
			<otherwise></otherwise>
		</choose>
		order by c.code desc) 
		where <![CDATA[rownum<=(${nowPage}*${onePageRecord})]]> order by code asc) where <![CDATA[rownum<=${lastPageRecordCount}]]> order by code desc 
	</select>
	<select id="getClassListSearch" parameterType="com.bitcamp.gachi.admin.TestVO" resultType="com.bitcamp.gachi.admin.ClassVO">
		select * from (select * from (select code,category,class_name,nickname,total_student,to_char(signup,'YYYY-MM-DD') signup,
		to_char(allow,'YYYY-MM-DD') allow,class_state from class c join member m on c.userid=m.userid 
		<choose>
			<when test='option!=null and option.equals("전체")'>
				where c.code like '%${searchWord}%' or c.category like '%${searchWord}%' or 
				c.class_name like '%${searchWord}%' or c.userid like '%${searchWord}%' or c.class_state like '%${searchWord}%'
			</when>
			<when test='option!=null and !option.equals("전체")'>
				where ${option} like '%${searchWord}%'
			</when>
		</choose>
		order by c.code desc) 
		where <![CDATA[rownum<=(${nowPage}*${onePageRecord})]]> order by code asc) where <![CDATA[rownum<=${lastPageRecordCount}]]> order by code desc
	</select>
	<select id="selectClass" parameterType="String" resultType="com.bitcamp.gachi.admin.ClassVO">
		select code,category,class_name,stage,full_price,real_price,good,allow,class_state,class_info,class_img from class where code=#{code}
	</select>
	<select id="selectSection" parameterType="String" resultType="com.bitcamp.gachi.admin.ClassVideoVO">
		select section_code,unit,unit_content from section where code=#{param1} order by unit
	</select>
	<select id="getClassVideoListSample" parameterType="String" resultType="com.bitcamp.gachi.admin.ClassVideoVO">
		select video_code,unit,section_index,s.unit_content,video_name,video_filename,video_length,
		to_char(enroll_date,'YYYY-MM-DD') enroll_date from section s join class_video c on s.section_code=c.section_code 
		where c.code=s.code and c.code='${param1}'
	</select>
	<update id="updateClassState" parameterType="String">
		update class set class_state='등록승인' where code='${code}'
	</update>	
	<delete id="deleteClass" parameterType="String">
		delete from class where code='${param1}'
	</delete>	
	<update id="updateClass" parameterType="com.bitcamp.gachi.admin.ClassVO">
		update class set category='${category}',class_name='${class_name}',stage='${stage}',
		full_price='${full_price}',real_price='${real_price}',class_state='${class_state}',
		class_info='${class_info}' where code='${code}'  
	</update>
	<select id="selectClassImg" parameterType="String" resultType="String">
		select class_img from class where code='${code}'
	</select>
	<update id="updateClassImg" parameterType="String">
		update class set class_img='${param1}' where code='${param2}'
	</update>
	<select id="getClassAllList" parameterType="String" resultType="com.bitcamp.gachi.admin.ClassVO">
		select code,class_name from class where category='${param1}' order by code
	</select>
	<select id="getCode" parameterType="String" resultType="String">
		select code from class where class_name='${param1}'
	</select>
	<select id="getUnitMax" parameterType="String" resultType="int">
		select max(unit) unit from section where code='${param1}'
	</select>
	<select id="getUnitContent" parameterType="String" resultType="String">
		select unit_content from section where code='${param1}' order by unit
	</select>
	<select id="selectSectionCode" parameterType="String" resultType="String">
		select section_code from section where unit_content='${param1}'
	</select>
	<insert id="videoInsert" parameterType="com.bitcamp.gachi.admin.ClassVideoVO">
		insert into class_video(code,section_code,section_index,video_code,video_name,video_filename,
		video_length,enroll_date) values('${code}','${section_code}',${section_index},
		'${video_code}'||A_SQ.nextval,'${video_name}','${video_filename}',${video_length},sysdate)
	</insert>
	<delete id="deleteSection" parameterType="String">
		delete from section where section_code='${param}'
	</delete>
</mapper>